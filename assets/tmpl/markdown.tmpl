<!DOCTYPE html>
<html>
	<head>
		<link href="/.httpServe/markdown/css/github.min.css" rel="stylesheet">
		<link href="/.httpServe/markdown/css/highlight.min.css" rel="stylesheet">

		<script src="/.httpServe/_reload/wsrpc.js"></script>
		<script src="/.httpServe/markdown/js/highlight.min.js"></script>
		<script src="/.httpServe/markdown/js/showdown.min.js"></script>
		<script src="/.httpServe/markdown/js/viz.js"></script>
		<style>
			body {
				margin: 20px 20%;
			}
		</style>
	</head>
	<body class="markdown-body">
	<markdown style="display:none;">{{.content}}</markdown>
	<div id="output">
	</div>

	<script>
		hljs.initHighlightingOnLoad();
		var converter = new showdown.Converter()
		converter.setFlavor('github');
		converter.setOption('simpleLineBreaks',false)

		var outputEl = document.getElementById('output')
		var elList = document.getElementsByTagName('markdown')
		if (elList.length == 0) {
			outputEl.innerHTML = 'Error finding element'
		}
		var inEl = elList[0]
		outputEl.innerHTML =  converter.makeHtml(inEl.innerText)

		// Process viz
		elList = document.querySelectorAll("code.viz,code.dot")

		for (var i = 0; i < elList.length; i++) {
			var text = elList[i].innerText
			var res = Viz(text)
			var divEl = document.createElement("div")
			divEl.innerHTML= res
			// get <pre> node
			elList[i].parentNode.parentNode.replaceChild(divEl, elList[i].parentNode)
			//elList[i].innerHTML = res
		}

	</script>
	<script src="/.httpServe/js/watcher.js"></script>
	</body>
</html>
